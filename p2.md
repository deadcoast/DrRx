Awesome—moving into PHASE_2. Here’s a complete, ship-ready documentation suite plan tailored to DrRx’s strict UDL + Windows-first CLI.

# DrRx Documentation Suite — Plan

## 0) Goals & Audiences

* **Goals:** Make the UDL unambiguous, the CLI predictable, and ops safe. New users reach “first successful inject” in <10 minutes; power users can script/automate confidently; contributors can extend parser/CLI without regressions.
* **Audiences:** (a) Users (author .drrx, run CLI), (b) Operators (backup/restore/audit), (c) Contributors (parser, AST, commands), (d) Reviewers (security/UX).

---

## 1) Top-Level Docs Layout (filenames + purpose)

```
docs/
  00-index.md
  01-concepts/
    what-is-drrx.md
    mental-model.md
    udl-overview.md
  02-quickstart/
    install-windows.md
    first-inject.md
    dry-run-and-rollback.md
  03-udl-spec/
    udl-dictionary.md
    udl-spacing-rules.md
    udl-grammar-ebnf.md
    udl-alignment-and-flow.md
    udl-linting-guide.md
    udl-examples.md
  04-cli/
    cli-overview.md
    cmd-inject.md
    cmd-list-ls.md
    cmd-restore.md
    cmd-del-deldir-delall.md
    cmd-adddir-addfile.md
    cmd-log-audit-clear.md
    cmd-quicksave.md
    global-flags.md
    exit-codes.md
  05-workflows/
    reconcile-target-dir.md
    backups-and-quicksave.md
    auditing-and-change-review.md
    migration-existing-tree.md
  06-recipes/
    python-project-skeleton.md
    mixed-code-and-docs.md
    monorepo-slices.md
    template-repo-bootstrap.md
  07-windows-deep-dive/
    paths-crlf-case.md
    junctions-symlinks.md
    permissions-acls.md
    long-paths-support.md
  08-reference/
    ast-json-schema.md
    drrx-conf-schema.md
    error-catalog.md
    logging-format.md
  09-test-and-quality/
    conformance-suite.md
    fixtures-and-golden-tests.md
    coverage-strategy.md
    perf-baselines.md
  10-project/
    roadmap.md
    versioning-and-changelog.md
    security-model.md
    threat-checklist.md
    contributing.md
    code-of-conduct.md
    style-guide.md
    architecture.md
    decision-records.md
```

---

## 2) Minimum Viable Content (per file)

### 00-index.md

* **Purpose:** One-page map of the documentation. Links to Quickstart and UDL Spec. Clear “Start here”.

### 01-concepts/*

* **what-is-drrx.md:** Problem statement; “single source of truth for directories.”
* **mental-model.md:** Source-of-truth (spec) ↔ reconciler (CLI) ↔ target (FS). Idempotence & determinism.
* **udl-overview.md:** Symbols (`.`, `--`, `==`, `+`, `:`, `|`) with one canonical diagram.

### 02-quickstart/*

* **install-windows.md:** Supported Windows versions; PowerShell prerequisites; optional long-path enablement.
* **first-inject.md:** Create a minimal `.drrx`; run `drrx inject --dry-run`; apply; verify with `drrx list`.
* **dry-run-and-rollback.md:** Using `--dry-run`, `quicksave`, and `restore` safety loop.

### 03-udl-spec/*

* **udl-dictionary.md:** Exact definitions for all operators; one-liners + non-ambiguous examples.
* **udl-spacing-rules.md:** [SP.01], [SP.02] with pass/fail visual examples.
* **udl-grammar-ebnf.md:** Formal grammar (see sample below).
* **udl-alignment-and-flow.md:** Alignment to terminal chars; vein continuity with `|`; open/close semantics.
* **udl-linting-guide.md:** Common mistakes; linter rules; auto-fix suggestions (if any).
* **udl-examples.md:** Canonical trees (small→medium→large), including mixed directories/files.

**Sample EBNF (to include & expand):**

```ebnf
Document        = RootHeader , RootFiles? , Vein? , Directories? ;
RootHeader      = "." ;
RootFiles       = { RootFileLine } ;
RootFileLine    = ":" , "==" , SP , FileName , EOL ;
Vein            = "|" , EOL ;
Directories     = { DirectoryBlock } ;

DirectoryBlock  = FlowPrefix , "--" , SP , DirName , "/" , EOL , Children? ;
FlowPrefix      = ":" | "+" ;
Children        = ( VeinChildren | ClosedChildren ) ;
VeinChildren    = "|" , SP? , ( FileLine | DirectoryBlock ) , { "|" , SP? , ( FileLine | DirectoryBlock ) } ;
ClosedChildren  = SP* , ( FileLine | DirectoryBlock ) , { SP* , ( FileLine | DirectoryBlock ) } ;

FileLine        = FlowPrefix , "==" , SP , FileName , EOL ;

SP              = " " ;
EOL             = "\r\n" | "\n" ;
FileName        = NameChars ;
DirName         = NameChars ;
NameChars       = ? any valid file/directory name chars excluding separators ? ;
```

### 04-cli/*

* **cli-overview.md:** Command structure; config discovery; environment assumptions.
* **cmd-inject.md:** Behavior matrix (create/update/delete), `--file|--dir|--all|--force|--dry-run`; safety guarantees.
* **cmd-list-ls.md:** Output shapes (tree/flat); filtering.
* **cmd-restore.md:** Sources (`quicksave` snapshots), restore targets, dry-run restore.
* **cmd-del* / add* / log / audit / clear / quicksave / global-flags.md / exit-codes.md:** Each with synopsis, options table, examples, and return codes.

**Example per-command skeleton:**

```md
# drrx inject

**Synopsis**
```

drrx inject --file <file> | --dir <dir> | --all <dir> [--force] [--dry-run]

```

**Description**
- Applies the current `.drrx` spec to the target, reconciling differences deterministically.

**Options**
| Option | Alias | Required | Description |
|---|---|---:|---|
| `--file <file>` | `--cow` | no | Inject a single file path declared in spec |
| `--dir <dir>`   | `--barn`| no | Inject a directory and its tree |
| `--all <dir>`   | `--farm`| no | Inject recursively from root |
| `--force`       |        | no | Allow destructive changes (see Safety) |
| `--dry-run`     |        | no | Show actions without applying |

**Safety**
- No destructive ops without `--force`. See **Security Model**.

**Examples**
- …

**Exit codes**
- `0` success; `10` validation error; `20` parse error; `30` fs-permission; `40` conflict; `50` unknown.
```

### 05-workflows/*

* **reconcile-target-dir.md:** How diffs are computed; precedence rules (spec vs target); conflict handling.
* **backups-and-quicksave.md:** Where snapshots live; naming; retention.
* **auditing-and-change-review.md:** Audit log format; how to diff between runs.
* **migration-existing-tree.md:** Ingest an existing directory into a `.drrx` (order: scan → normalize → emit UDL → review → inject).

### 06-recipes/*

Concrete, copy-pasteable `.drrx` examples with commentary:

* Python project layout; monorepo packages; docs + code split; asset trees.

### 07-windows-deep-dive/*

* **paths-crlf-case.md:** Path separators, CRLF vs LF handling, case sensitivity realities on Windows.
* **junctions-symlinks.md:** How DrRx treats them (create? ignore? validate?).
* **permissions-acls.md:** Running elevated? Handling denies.
* **long-paths-support.md:** Enabling long paths; behavior without it.

### 08-reference/*

* **ast-json-schema.md:** JSON Schema for the parser AST (node types: Root, Dir, File, Vein, FlowPrefix, SpacingMeta).
* **drrx-conf-schema.md:** Machine-readable schema for `.drrx.conf.yaml` (if applicable).
* **error-catalog.md:** IDs, messages, cause, remediation, examples.
* **logging-format.md:** Log levels, fields, sample lines.

**Sample Error Catalog row:**

| ID          | Name            | When                 | Message                         | Remediation                                     |
| ----------- | --------------- | -------------------- | ------------------------------- | ----------------------------------------------- |
| E-PARSE-001 | UnexpectedToken | token not in grammar | `Unexpected token ':' at col 3` | Check [udl-grammar-ebnf.md] and alignment rules |

### 09-test-and-quality/*

* **conformance-suite.md:** How to run a corpus of `.drrx` files to ensure grammar + semantics across versions.
* **fixtures-and-golden-tests.md:** Directory fixtures → expected AST → expected fs result.
* **coverage-strategy.md:** Parser, reconciler, CLI surface; mutation tests for safety toggles.
* **perf-baselines.md:** Large trees (10k nodes) targets & timing.

### 10-project/*

* **roadmap.md:** Short, Mid, Long—e.g., linter, formatter, symlink strategy, non-Windows support (future).
* **versioning-and-changelog.md:** SemVer; categories; keep a `CHANGELOG.md` with a strict template.
* **security-model.md:** Destructive ops require `--force`; sandboxing; path traversal prevention; dry-run-first guidance.
* **threat-checklist.md:** Mis-specified root, accidental deletes, privilege escalation, malicious spec injection.
* **contributing.md:** How to add a command, grammar change protocol, test expectations.
* **code-of-conduct.md:** Standard.
* **style-guide.md:** Writing style (no ambiguity, show-pass/fail), code style pointers.
* **architecture.md:** High-level diagram: Lexer → Parser → AST → Planner (diff) → Executor → Reporter.
* **decision-records.md:** ADR template & initial ADRs (e.g., choose `|` as vein connector; Windows-first).

---

## 3) Canonical Templates (drop-in)

### 3.1 Doc Page Template

```md
# <Title>

## Purpose
<One paragraph – what this page guarantees.>

## Outcome
<What the reader can do after reading.>

## Definitions
<Bullets if needed. Link to glossary.>

## Procedure / Rules / API
<Step-by-step or spec with examples.>

## Examples
<Pass/Fail blocks, before/after.>

## Troubleshooting
<Common errors mapped to Error Catalog IDs.>

## References
<Internal links to related pages.>
```

### 3.2 ADR Template (`/docs/10-project/decision-records/ADR-YYYYMMDD-<slug>.md`)

```md
# ADR: <Decision title>

- **Status:** Proposed | Accepted | Superseded
- **Context:** <Problem, constraints>
- **Decision:** <What we chose and why>
- **Consequences:** <Trade-offs, risks>
- **Alternatives:** <Briefly list>
- **Links:** <PRs, issues, specs>
```

### 3.3 Changelog Entry Template

```md
## [x.y.z] - 2025-10-24
### Added
- …

### Changed
- …

### Fixed
- …

### Security
- …
```

---

## 4) Style & Quality Gates

* **Zero-Ambiguity Rule:** Every operator has at least one **pass** and one **fail** example.
* **Single Source Rule:** UDL grammar → generated linter rules → CLI behavior; no divergence.
* **Docs CI (later):** Validate code blocks compile/run where applicable; link checker; schema validation for examples.

---

## 5) Acceptance Criteria (when this suite is “complete”)

1. A new user can install, author a minimal `.drrx`, dry-run, inject, list, quicksave, and restore—**only** from 00→02.
2. UDL is fully specified with grammar, spacing, alignment, and at least 10 canonical examples with pass/fail.
3. Every CLI command has a page with synopsis, options table, safety notes, examples, and exit codes.
4. Error Catalog covers all parse/validate/exec errors referenced by examples.
5. Conformance Suite doc includes how to run fixtures + expected outputs.
6. Security Model and Windows deep-dives exist and are cross-linked from risky commands (`--force`).

---

## 6) Immediate Next Steps (suggested order)

1. Draft **02-quickstart** (install, first inject, dry-run/rollback).
2. Lock **03-udl-spec** (dictionary, spacing, grammar, alignment) with pass/fail blocks.
3. Write **04-cli** pages for `inject`, `restore`, `list/ls`, `quicksave` (the critical path).
4. Publish **08-reference/error-catalog.md** and use IDs in all examples.
5. Add **05-workflows/reconcile-target-dir.md** to explain deterministic planning.
6. Add **10-project/versioning-and-changelog.md** + **security-model.md**.

---

If this structure works for you, I’ll proceed to **PHASE_3** by stubbing the highest-value pages (Quickstart, UDL Spec core, CLI inject/restore) in your preferred style and tone.
