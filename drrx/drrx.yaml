# Directory Remedy [Dr.Rx] Reinforcing Directory Tree Syntax
# CLI Design Patterns (Command Line Interface Design Patterns)
directory_remedy:
  description: "A strict directory tree syntax (Dr.Rx) file that declaratively manages a target Windows directory. Idempotent: repeated application converges FS to declared state."
  cli_command:
    name: "drrx"
    alias: "drrxm"
    principle: "Manage a directory based on one Dr.Rx tree file; indentation defines structure; operators declare directories/files; annotations can affect presence and sourcing."
    commands:
      - name: "inject"
        description: "Parse and apply a Dr.Rx tree to a target directory. Ensures declared nodes exist; honors annotations (e.g., { state: absent }). Does not delete unspecified nodes unless --prune."
        example: 'drrx inject --file C:\\path\\tree.drrx --dir C:\\target'
        options:
          - name: "--file <file>"
            alias: "--cow <file>"
            description: "Path to a Dr.Rx file to apply."
          - name: "--dir <directory>"
            alias: "--barn <directory>"
            description: "Target directory root to reconcile with the Dr.Rx file."
          - name: "--all"
            alias: "--farm"
            description: "Apply recursively (default). Kept for compatibility."
          - name: "--force"
            description: "Override safety checks (e.g., apply even when warnings are present)."
          - name: "--prune"
            description: "Remove FS nodes not declared in Dr.Rx under the target (dangerous)."
          - name: "--strict <level>"
            description: "Validation strictness: off|warn|error (default: warn). Tabs, flow mismatches, etc."
          - name: "--dry-run"
            description: "Show planned changes without modifying the filesystem."
          - name: "--snapshot <file>"
            description: "Write applied AST snapshot to a JSON file for auditing."
          - name: "--help <command>"
            description: "Displays help information for a command"
      - name: "list"
        description: "List effective desired state (from Dr.Rx) and/or actual FS contents; can show diff."
        example: 'drrx list --file C:\\path\\tree.drrx --dir C:\\target --diff'
        options:
          - name: "--file <file>"
            description: "Optional Dr.Rx file to compute desired state."
          - name: "--dir <directory>"
            description: "Target directory to scan for actual state."
          - name: "--diff"
            description: "Show diff between desired and actual: add/change/delete."
          - name: "--json"
            description: "Emit machine-readable JSON of listing/diff."
      - name: "restore"
        description: "Re-apply the most recent snapshot or the provided Dr.Rx file to reconcile target to desired state. Honors { state: absent } by removing nodes."
        example: 'drrx restore --dir C:\\target --snapshot .drrx.last.json'
        options:
          - name: "--dir <directory>"
            alias: "--barn <directory>"
            description: "Target directory root to restore."
          - name: "--all"
            alias: "--farm"
            description: "Process recursively (default). Kept for compatibility."
          - name: "--force"
            description: "Override safety checks during restore."
          - name: "--dry-run"
            description: "Show planned changes without modifying the filesystem."
          - name: "--snapshot <file>"
            description: "Path to a prior AST snapshot JSON to re-apply."
          - name: "--help <command>"
            description: "Displays help information for a command"
      - name: "ls"
        description: "Alias for list."
      - name: "del"
        description: "Remove file(s) from FS and/or set { state: absent } in Dr.Rx."
        subcommands:
          - name: "deldir"
            description: "Remove a directory from FS and/or mark it absent in Dr.Rx."
          - name: "delall"
            description: "Remove all nodes under a path. With --mark, annotate Dr.Rx with { state: absent }."
        options:
          - name: "--path <path>"
            description: "Relative path under target to delete."
          - name: "--mark"
            description: "Update Dr.Rx to add or set corresponding node(s) to { state: absent }."
          - name: "--force"
            description: "Bypass confirmation."
          - name: "--dry-run"
            description: "Show planned deletions only."
      - name: "adddir"
        description: "Scan a directory on FS and append/update corresponding directory node(s) in Dr.Rx. Respects quoting rules for names with spaces."
        options:
          - name: "--path <path>"
            description: "Relative path under target to add into Dr.Rx."
          - name: "--recursive"
            description: "Include subtree."
          - name: "--state <present|absent>"
            description: "Set initial state annotation for the added node(s)."
      - name: "addfile"
        description: "Append/update a file node in Dr.Rx for a file on FS."
        options:
          - name: "--path <path>"
            description: "Relative file path under target to add."
          - name: "--source <inline|template:id|url:https>"
            description: "Set source annotation for file contents."
          - name: "--state <present|absent>"
            description: "Set initial state."
      - name: "help"
        alias: "h"
        description: "Displays help information"
      - name: "log"
        alias: "l"
        description: "Show operation log; include applied snapshots when available."
      - name: "audit"
        alias: "a"
        description: "Show validation warnings/errors and flow/indent mismatches detected."
      - name: "clear"
        alias: "c"
        description: "Clear audit and operation logs."
      - name: "quicksave"
        alias: "qs"
        description: "Write an AST snapshot (JSON) of current Dr.Rx + target FS reconciliation plan."
  features: "TODO: Add features"
